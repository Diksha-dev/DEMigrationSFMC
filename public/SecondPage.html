<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/design-system/2.14.1/styles/salesforce-lightning-design-system.min.css" />
    <link rel="icon" href="https://developer.salesforce.com/resources2/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="https://developer.saleforce.com/resources2/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <title>DE SFMC</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.js"></script>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/design-system/2.13.7/styles/salesforce-lightning-design-system.min.css"
        integrity="sha512-UV/bdfkf/vUvwZ6/aVq8zas293BNyu43i68QdurkfUmSjGRiCxKISDe29R6VPB3YKfeA/lCjGyfXLBIzlpTg5A=="
        crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"> </script>
    <link href="https://cdn.datatables.net/1.10.7/css/jquery.dataTables.min.css" rel="stylesheet" />

</head>

<body>


    <div class="slds-grid slds-wrap">

        <div class="slds-col slds-size_3-of-12">
            <article class="slds-card">
                <div class="slds-card__header slds-grid slds-align_absolute-center">
                    <header class="slds-media slds-media_center slds-has-flexi-truncate">
                        <div class="slds-media__figure">
                            <img class="slds-icon_container"
                                src="https://upload.wikimedia.org/wikipedia/commons/1/1b/Sf-marketingcloud-logo.png"
                                title="Source SFMC" width="170" height="170">
                            <span class="slds-assistive-text">Source SFMC</span>
                            </img>
                        </div>
                    </header>
                </div>
                <br />
                <div class="slds-card__body slds-card__body_inner slds-align_absolute-center">
                    <div class="slds-panel slds-size_medium slds-panel_docked slds-panel_docked-left slds-is-open"
                        aria-hidden="false">
                        <div class="slds-panel__header">
                            <h2 class="slds-panel__header-title slds-text-heading_small slds-truncate"
                                title="Panel Header">
                                Contents
                            </h2>
                        </div>

                        <div class="slds-panel__body slds-align_absolute-center">
                            <div class="demo-only" style="width:320px">
                                <nav class="slds-nav-vertical slds-nav-vertical_compact" aria-label="Sub page">
                                    <div class="slds-nav-vertical__section">
                                        <ul aria-describedby="entity-header">
                                            <li class="slds-nav-vertical__item slds-is-active">
                                                <button class="slds-button slds-button_brand slds-align_absolute-center"
                                                    onclick="DEListShow()">DE Extension</button>
                                            </li>
                                            &nbsp;
                                            <li class="slds-nav-vertical__item slds-is-active">
                                                <button class="slds-button slds-button_brand slds-align_absolute-center"
                                                    onclick="SendDEIdsToServer()">Send</button>
                                            </li>
                                        </ul>
                                    </div>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </article>
        </div>
        <div class="slds-col slds-size_9-of-12">
            <table class="slds-table slds-table--bordered" id="DEDataTableId">
                <thead>
                    <tr class="slds-text-heading--label">
                        <th class="slds-cell-shrink" scope="col">
                            <label class="slds-checkbox" for="select-all">
                                <input name="checkbox" type="checkbox" id="select-all" />
                                <span class="slds-checkbox--faux"></span>
                                <span class="slds-form-element__label slds-assistive-text">select all</span>
                            </label>
                        </th>
                        <th class="slds-is-sortable" scope="col">
                            <span class="slds-truncate">Name</span>
                        </th>
                        <th scope="col">
                            <span class="slds-truncate">External Key</span>
                        </th>
                        <th scope="col">
                            <span class="slds-truncate">Description</span>
                        </th>
                        <th scope="col">
                            <span class="slds-truncate">Sendable</span>
                        </th>
                    </tr>
                </thead>
                <tbody id="DEBody">

                </tbody>
            </table>
        </div>
    </div>

</body>
<script>
    var SourceListDEResult;
    async function DEListShow() {
        await $.ajax
            ({
                url: '/DEListShowAPI',
                data: {
                    'reqForDEList': 'True'
                },
                type: "POST",
                headers: {
                    'Content-type': 'application/x-www-form-urlencoded'
                },
                success: function (data) {
                    //console.log('data : ' + JSON.stringify(data));
                    SourceListDEResult = data;
                    var tds = "", DEDes = '', i = 1;
                    for (var key in SourceListDEResult) {
                        if (JSON.stringify(SourceListDEResult[key].Description) == '{}') {
                            DEDes = '';
                        }
                        else {
                            DEDes = SourceListDEResult[key].Description;
                        }
                        tds = tds + '<tr class="slds-hint-parent"> ' +
                            '<td class="slds-row-select"> ' +
                            '<label class="slds-checkbox"> ' +
                            '<input type="checkbox" id="'+ SourceListDEResult[key].CustomerKey +'"/> ' +
                            '<span class="slds-checkbox--faux"></span> ' +
                            '<span class="slds-form-element__label slds-assistive-text">select row' + i + '</span> ' +
                            '</label> ' +
                            '</td>' +
                            '<th data-label="name" role="row" id="DEName'+i+'">' + SourceListDEResult[key].Name + '</th> ' +
                            '<td data-label="external-key" id="DEExtKey'+i+'">' + SourceListDEResult[key].CustomerKey + '</td> ' +
                            '<td data-label="description" id="DEDes'+i+'">' + DEDes + '</td>' +
                            '<td data-label="sendable" id="DEIsSend'+i+'">' + SourceListDEResult[key].IsSendable + '</td>' +
                            '</tr>';
                        i = i + 1;
                    }
                    document.getElementById('DEBody').innerHTML = tds;
                }
            })
    }


    function SendDEIdsToServer() {
        var grid = document.getElementById("DEDataTableId");
        var checkBoxes = grid.getElementsByTagName("input");
        var selectedDE = {};
        for (var i = 0; i < checkBoxes.length; i++) {
            if (checkBoxes[i].checked == true) {
                selectedDE[document.getElementById("DEExtKey"+i).innerHTML] = {
                    "DEName" : document.getElementById("DEName"+i).innerHTML,
                    "DEExtKey" : document.getElementById("DEExtKey"+i).innerHTML,
                    "DEDes" : document.getElementById("DEDes"+i).innerHTML,
                    "DEIsSend" : document.getElementById("DEIsSend"+i).innerHTML
                };
            }
        }
        console.log(selectedDE);
        //selectedDE = selectedDE.toString();




        $.ajax
            ({
                url: '/SelectedDEList',
                data: {
                    'reqForSelectedDEList': selectedDE
                },
                type: "POST",
                headers: {
                    'Content-type': 'application/x-www-form-urlencoded'
                },
                success: function (data) {
                    console.log('data : ' + JSON.stringify(data));
                }
            })






    }
</script>

</html>